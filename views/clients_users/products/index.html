<div ng-controller="products">

<div class="accordion large-heading" data-role="accordion">
    <div class="frame">
        <div class="heading"><span class="mif-plus icon"></span> Agregar</span></div>
        <div class="content" align="center">
        <!-- Nuevo producto-->
        <div class="panel info">
        <div class="heading">
        
        <span class="title">Nuevo producto</span>
        </div>
        <div class="content">


        
            <div class="row flex-just-sa">
                <div class="cell-auto-size">
                <br>
                
                <div ng-show="product.img_load">
                <div data-role="preloader" data-type="cycle" data-style="color" style="margin: auto" align=""></div>
                </div>

                <div style="border: 20px solid transparent">
                    <img ng-show="!product.img_load" ng-src="{{product.img}}" style="
                    width: auto;
                    height: auto;">
                </div>
                
                
                <br><br>
                </div>
                <div class="cell-auto-size">
                <br>
                <form align="center" enctype="multipart/form-data">  

                    <div class="input-control select" >
                    <select ng-model="product.category" style="text-align: center; text-align-last: center;">
                        <option value="">---Cetegorias---</option>
                        <option ng-repeat=" a in categories" value="{{ a._id }}">{{a.categoria}}</option>
                    </select>
                    </div>
                    
                    
                    <div class="input-control file" data-role="input" ng-model="product.img">
                        <input type="file" placeholder="Imagen" onchange="angular.element(this).scope().photoChanged(this.files)">
                        <button class="button" ><span class="mif-folder"></span></button>

                    </div>
                    <br>
                    
                    <div class="input-control modern text iconic" id="widthfull">
                    <input type="text" placeholder="Codigo" ng-model="product.codebar" class="input-full">
                    <span class="label">Codigo</span>
                    <span class="informer"></span>
                    <span class="icon mif-barcode"></span>
                    </div>

                    <div class="input-control modern text iconic" id="widthfull">
                    <input type="text" placeholder="Nombre" ng-model="product.name" class="input-full">
                    <span class="label">Nombre</span>
                    <span class="informer"></span>
                    <span class="icon mif-stack3"></span>
                    </div>
                    
                    <div class="input-control modern text iconic" id="widthfull">
                    <input type="text" placeholder="Descripcion" ng-model="product.description" class="input-full" >
                    <span class="label">Descripcion</span>
                    <span class="informer"></span>
                    <span class="icon mif-paragraph-left"></span>
                    </div>
                    
                    <div class="input-control modern text iconic" id="widthfull" ng-show="!use_receta_create">
                    <input type="number" placeholder="Stock" ng-model="product.stock" class="input-full" >
                    <span class="label">Stock</span>
                    <span class="informer"></span>
                    <span class="icon mif-list-numbered"></span>
                    </div>
                    <br>
                    <label class="switch-original">
                        <input type="checkbox" ng-model="use_receta.status" ng-change="loadreceta()" ng-disabled="use_receta_load"> Usar receta
                        <span class="check"></span>
                    </label>
                    <br><br>

                    
                    <!-- Receta-->
                    <div ng-show="use_receta_load">

                        <div class="cell">
                        <div data-role="preloader" data-type="cycle" data-style="color" style="margin: auto" align=""></div>
                        </div>

                    </div>

                    <!--Usar receta-->
                    <div ng-show="use_receta_create" align="center">
                        
                        <div class="input-control select" >
                        <select ng-model="product.receta" style="text-align: center; text-align-last: center;">
                            <option value="">---Recetas---</option>
                            <option ng-repeat=" a in recetas" value="{{ a._id }}">{{a.name}}</option>
                        </select>
                        </div>

                    </div>
                    <!-- FInaliza Usar receta-->
                    <!-- FInaliza Receta-->

                    <br>
                    
                    <button class="button success loading-pulse" ng-click="create()">
                    Agregar
                    </button>
                </form>
                <br>
                </div>
            </div>
        
    </div>
</div>
    <!-- Finaliza Nuevo producto-->
        </div>
    </div>
</div>
    <!--Lista de productos-->
    <div class="panel success" style="border: 2px solid #fff">
                <div class="heading">
                
                <span class="title">Productos</span>
            
                </div>
                <div class="content">
                <!--Busqueda y numero mostrado -->
    <div class="grid">
        <div class="row flex-just-sa">
            <div class="colspan6" style="width: 100%" align="center">
            <form >
                <div class="input-control text " data-role="input" style="width: 95%">
    
            <input type="text" name="filter" ng-model="inputbox.text" placeholder="Buscar">
    
            <button class="button" ng-click="search()"><span class="mif-search"></span></button></div>
            </form>
            </div>
            <div class="colspan6" style="width: 100%" align="center">
                <div class="input-control select" style="width: 95%">
                <select ng-model="pageSizetmp.items" ng-change="ChangePageItems()" style="text-align: center; text-align-last: center;">
                    <option value="">---Items mostrados---</option>
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="40">40</option>
                    <option value="60">60</option>
                    <option value="80">80</option>
                    <option value="100">100</option>
                    <option value="todos">Ver todos</option>
                </select>
                </div>
            </div>
        </div>
    </div>
    <!--Finaliza Busqueda y numero mostrado -->
    <table class="table striped hovered bordered border">
         <thead>
            <tr>
            <th>CODEBAR</th>
            <th>PRODUCTO</th>
            <th>CATEGORIA</th>
            <th>RECETA</th>
            <th>STOCK/PREPARACION</th>
            <th>OPCIONES</th>
            </tr>
          </thead>
          <tbody>
              <tr ng-repeat="a in products | startFromGrid: currentPage * pageSize | limitTo: pageSize" ng-model="products" >
                <td>{{ a.codebar }}</td>
                <td>{{ a.name }}</td>
                <td>{{ a.category.categoria }}</td>
                <td ng-if="a.receta.name != null">{{ a.receta.name }} </td>
                <td ng-if="a.receta.name == null">NINGUNA</td>
                <td ng-if="a.receta.name == null">Stock: {{ a.stock }}</td>
                <td ng-if="a.receta.name != null">Platillos: {{ calulate(a.receta._id) }}</td>
                <td>
                    <div class="dropdown-button" ng-if="a.receta.name != null">
                    <button class="button success dropdown-toggle">{{ a.receta.name }}</button>
                        <ul class="split-content d-menu" data-role="dropdown">
                            <li><a href="dashboard#/surtir_receta/{{ a.receta._id }}">Surtir ingredientes</a></li>
                            <li class="divider"></li>
                            <li><a href="dashboard#/view_recetas/{{ a.receta._id }}">Ver receta</a></li>
                            <li><a href="dashboard#/edit_recetas/{{ a.receta._id }}">Editar receta</a></li>

                        </ul>
                    </div>
                    <a href="dashboard#/products/{{ a._id }}">
                        <button class="button primary mif-pencil" ng-Click="update(a)"> Actualizar</button>
                    </a>
                </td>
                
              </tr>
          </tbody>
    </table>
<div class="grid">
    <div class="row flex-just-sa">
        <div class="cell-auto-size">
        <div class='pagination'>
          <button type='button ' class='item' ng-disabled='currentPage == 0' ng-click='currentPage = 0'>Principio</button>

          <button type='button' class='item' ng-disabled='currentPage == 0' ng-click='currentPage = currentPage - 1'>&laquo;</button>
          
          <button type='button' class='item current' ng-disabled='currentPage == page.no - 1' ng-click='setPage(page.no)' ng-repeat='page in pages'>{{ page.no }}</button>
          
          <button type='button' class='item' ng-disabled='currentPage >= products.length/pageSize - 1' , ng-click='currentPage = currentPage + 1'>&raquo;</button>

          <button type='button' class='item' ng-disabled='currentPage == products.length/pageSize - 1' ng-click='currentPage = products.length/pageSize - 1'>Final</button>
        </div>
    </div>    
    </div>
</div>
<hr>
</div></div>
    <!--Finaliza Lista de productos-->
</div>